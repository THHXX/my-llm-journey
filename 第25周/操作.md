# 第25周：LangChain 核心组件入门 - 操作指南

本周目标是掌握 **LangChain** 的核心逻辑：如何把大模型（LLM）像积木一样拼装起来，完成复杂任务。

## 📂 目录
- [1. 环境准备](#1-环境准备)
- [2. 核心概念解析](#2-核心概念解析)
- [3. 代码实战](#3-代码实战)
- [4. 运行与验证](#4-运行与验证)

---

## 1. 环境准备

我们需要安装 LangChain 框架以及通义千问的 SDK。

在终端运行以下命令：

```powershell
pip install langchain langchain-community dashscope
```

> **注意**：本周代码示例使用了阿里云的 **通义千问 (Qwen-Max)** 在线 API。
> 如果你没有 API Key，可以去 [阿里云 DashScope](https://dashscope.console.aliyun.com/) 免费申请。

---

## 2. 核心概念解析

LangChain 就像是大模型开发的“胶水”和“脚手架”。

| 英文专有名词 | 中文含义 | 功能解释 (通俗版) |
| :--- | :--- | :--- |
| **LLM** | 大语言模型 | 大脑。负责思考和生成文本（如 GPT-4, Qwen）。 |
| **Prompt Template** | 提示词模板 | 填空题。把用户的输入填入预设的格式中，让模型更容易理解。 |
| **Chain** | 链 | 流程管家。把 Prompt、LLM 和其他处理步骤串联起来，一步步执行。 |
| **Agent** | 智能体 | 决策者。根据任务自主决定使用什么工具（Tool）来解决问题。 |
| **Tool** | 工具 | 手脚。模型本身无法联网或计算，Tool 让它能用 Google、计算器等。 |

---

## 3. 代码实战

我已为您在当前目录下创建了 `simple_chain.py`，您可以直接查看。

### 代码详解

```python
from langchain_community.llms import Tongyi
from langchain_core.prompts import PromptTemplate
from langchain_core.output_parsers import StrOutputParser
import os

# 💡 必须设置 API KEY
# os.environ["DASHSCOPE_API_KEY"] = "sk-xxxxxxxx"

# 1. 初始化大脑 (LLM)
llm = Tongyi(model="qwen-max") 

# 2. 定义填空题 (Prompt)
# 使用 .from_template 更简洁
prompt = PromptTemplate.from_template("将以下内容翻译成英文：{text}")

# 3. 串联成工作流 (Chain)
# 使用最新的 LCEL (LangChain Expression Language) 语法
# 这里的 | 符号就像管道一样，把数据从左传到右：
# 输入 -> Prompt -> LLM -> 字符串输出解析器
chain = prompt | llm | StrOutputParser()

# 4. 执行
print(chain.invoke({"text": "你好，世界"}))
```

---

## 4. 进阶实战：Web 界面 (Gradio)

为了让我们的工具更好用，我为您创建了 `app.py`，它提供了一个可视化的网页界面。

### 运行方式
```powershell
python 第25周/app.py
```
运行后，点击终端显示的 URL（通常是 `http://127.0.0.1:7860`），即可在浏览器中使用翻译助手。

---

## 5. 运行与验证

### 第一步：设置 API Key
在运行前，请确保你已经设置了环境变量，或者直接修改 `simple_chain.py` 代码：

**方式一（推荐，临时设置）：**
在终端执行：
```powershell
$env:DASHSCOPE_API_KEY="你的_sk_key_xxxxxxxx"
```

**方式二（修改代码）：**
打开 `simple_chain.py`，取消第 8 行的注释并填入 Key。

### 第二步：运行脚本
```powershell
python 第25周/simple_chain.py
```

### 第三步：验收结果
如果一切正常，您将看到如下输出：

```text
🚀 正在初始化 LangChain...

📝 开始翻译任务：

[1/5] 原文：你好，世界
      译文：Hello, World.

[2/5] 原文：LangChain 是一个开发大语言模型应用的框架。
      译文：LangChain is a framework for developing applications powered by large language models.
...
✅ 所有任务完成！
```

---

## 💡 进阶思考 (First Principles)
为什么需要 **Chain**？
直接调 API 不行吗？
- **直接调 API**：就像只有散乱的积木。
- **Chain**：是把积木搭好了形状。比如“翻译链”、“摘要链”。你可以把一个链的输出，作为另一个链的输入（比如先翻译，再写摘要），这就是**模块化**的力量。
