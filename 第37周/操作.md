# 第37周：Docker 容器化部署指南

## 1. 目录导航
- [1. 核心任务](#1-核心任务)
- [2. Docker 安装 (Windows)](#2-docker-安装-windows)
- [3. 构建镜像](#3-构建镜像)
- [4. 运行容器](#4-运行容器)
- [5. 常见问题 (FAQ)](#5-常见问题-faq)

## 1. 核心任务
本周我们学习如何将应用“打包”。
无论是在你的 Windows 电脑，还是在阿里云的 Linux 服务器，只要有 Docker，这个包就能一键运行，彻底告别“缺少依赖库”的烦恼。

## 2. Docker 安装 (Windows)

> **⚠️ 注意**：由于你的电脑是 Windows 11，安装 Docker 需要开启 WSL 2 (Windows Subsystem for Linux)。

### 步骤 1：开启 WSL 2
1. 打开 PowerShell (管理员模式)，运行：
   ```powershell
   wsl --install
   ```
2. **关键优化**：配置 `.wslconfig` 防止内存爆炸。
   你的电脑有 **16个逻辑核心** 和 **16GB 内存**，建议限制 Docker 使用一半资源。
   请在 PowerShell 中粘贴以下命令并回车（这将自动在你的用户目录创建配置文件）：
   ```powershell
   $config = @"
   [wsl2]
   memory=6GB
   processors=8
   swap=4GB
   localhostForwarding=true
   "@
   $config | Out-File -FilePath $env:USERPROFILE\.wslconfig -Encoding utf8
   ```
3. 重启电脑。

### 步骤 2：安装 Docker Desktop
1. 下载安装包：[Docker Desktop for Windows](https://www.docker.com/products/docker-desktop/)
2. 安装时勾选 "Use WSL 2 based engine"。
3. 安装完成后，启动 Docker Desktop，无需登录（可跳过）。

### 步骤 3：配置国内镜像源 (加速下载)
1. 打开 Docker Desktop 设置 -> **Docker Engine**。
2. 在 JSON配置中添加 `registry-mirrors`：
   ```json
   {
     "builder": {
       "gc": {
         "defaultKeepStorage": "20GB",
         "enabled": true
       }
     },
     "experimental": false,
     "registry-mirrors": [
       "https://docker.m.daocloud.io",
       "https://huecker.io",
       "https://dockerhub.timeweb.cloud", 
       "https://noohub.ru"
     ]
   }
   ```
3. 点击 **Apply & restart**。

## 3. 构建镜像

打开终端，进入本周目录：
```powershell
cd "f:\Desktop\个人资料\大模型学习项目\第37周"
```

执行构建命令（注意最后有个点 `.`）：
```powershell
docker build -t my-fastapi-app .
```

- `-t my-fastapi-app`: 给镜像起个名字。
- `.`: 使用当前目录下的 Dockerfile。

> **💡 提示**：第一次构建因为要下载 Python 基础镜像（约 50MB），可能会稍慢。后续构建会非常快。

## 4. 运行容器

镜像构建好后，我们把它跑起来：

```powershell
docker run -d -p 8000:8000 my-fastapi-app
```

- `-d`: 后台运行 (Detached mode)。
- `-p 8000:8000`: 将容器内部的 8000 端口映射到你电脑的 8000 端口。

**验证结果**：
打开浏览器访问 [http://localhost:8000](http://localhost:8000)，你应该能看到：
`{"Hello":"World","Status":"Docker 部署成功！"}`

## 5. 常见问题 (FAQ)

**Q: 为什么构建时卡在 `fetch http://...`？**
A: 这是网络问题。请确保 Docker Desktop 中配置了有效的国内镜像源（参考第2步），或者尝试开启科学上网工具（TUN模式）。

**Q: 为什么不直接用 vLLM？**
A: vLLM 需要 NVIDIA 显卡 + Linux 环境。在 Windows 核显环境下无法运行。我们下周将学习 **Bisheng** 平台，它是更适合你的国产化 LLM 应用解决方案。
