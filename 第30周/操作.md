# 第30周：多模态进阶（LLaVA，云端方案）

- [概述](#概述)
- [准备](#准备)
- [安装](#安装)
- [运行](#运行)
- [验收](#验收)
- [备注](#备注)

## 概述
本机无 NVIDIA 独显，不适合本地运行 LLaVA 7B/13B。采用云端 LLaVA（Replicate API）完成更强的图文问答，支持复杂问题。

## 准备
- 注册并获取 `REPLICATE_API_TOKEN`
- 在 PowerShell 设置环境变量：
```powershell
[Environment]::SetEnvironmentVariable("REPLICATE_API_TOKEN", "<你的token>", "User")
```
- 请开启科学上网工具以确保网络稳定。

## 安装
```powershell
pip install replicate pillow
```

## 运行
```powershell
python - << 'PY'
import os
import replicate
from PIL import Image

token = os.environ.get("REPLICATE_API_TOKEN")
if not token:
    raise SystemExit("未检测到 REPLICATE_API_TOKEN")

image_path = r".\第29周\example.jpg"
if not os.path.exists(image_path):
    raise SystemExit("请准备测试图片 example.jpg")

model = replicate.models.get("liuhaotian/llava-v1.5-7b")
version = model.versions.list()[0]
out = replicate.run(
    version,
    input={"image": open(image_path, "rb"), "prompt": "用中文详细描述图片，并回答我提出的复杂问题"}
)
print(out)
PY
```

## 验收
- 随机选择 2–3 张不同风格图片（含文字、复杂场景），输出需能回答细节问题，描述完整度高。

## 备注
- 云端调用按量计费（通常有免费额度）；网络不稳定时请重试。
