<!DOCTYPE html>
<html>
<head>
<style>
  /* æ•´ä½“å¸ƒå±€ */
  body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f4f6f8; color: #333; }
  .app-container { display: flex; height: 100vh; overflow: hidden; }
  
  /* å·¦ä¾§ä¾§è¾¹æ  (ç›®å½•) */
  .sidebar { width: 260px; background-color: #1e293b; color: #e2e8f0; flex-shrink: 0; display: flex; flex-direction: column; border-right: 1px solid #334155; }
  .sidebar-header { padding: 20px; font-size: 1.2rem; font-weight: bold; border-bottom: 1px solid #334155; background-color: #0f172a; }
  .sidebar-nav { flex: 1; overflow-y: auto; padding: 20px 0; }
  .sidebar-nav a { display: block; padding: 12px 24px; color: #94a3b8; text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent; font-size: 0.95rem; }
  .sidebar-nav a:hover { background-color: #334155; color: #fff; border-left-color: #38bdf8; }
  .sidebar-nav a.active { background-color: #334155; color: #fff; border-left-color: #38bdf8; }
  
  /* å³ä¾§æ­£æ–‡åŒºåŸŸ */
  .main-content { flex: 1; overflow-y: auto; padding: 40px 60px; background-color: #ffffff; scroll-behavior: smooth; }
  .content-wrapper { max-width: 900px; margin: 0 auto; }
  
  /* æ’ç‰ˆæ ·å¼ */
  h1 { font-size: 2.5rem; color: #0f172a; margin-bottom: 10px; border-bottom: 3px solid #38bdf8; padding-bottom: 15px; display: inline-block; }
  h2 { font-size: 1.8rem; color: #1e293b; margin-top: 40px; margin-bottom: 20px; padding-left: 15px; border-left: 5px solid #38bdf8; }
  h3 { font-size: 1.4rem; color: #334155; margin-top: 30px; }
  p { line-height: 1.8; color: #475569; margin-bottom: 15px; font-size: 1.05rem; }
  
  /* ä»£ç å— */
  pre { background-color: #1e293b; color: #e2e8f0; padding: 20px; border-radius: 8px; overflow-x: auto; font-family: 'Fira Code', Consolas, monospace; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
  code { background-color: #f1f5f9; color: #ef4444; padding: 2px 6px; border-radius: 4px; font-family: Consolas, monospace; font-size: 0.9em; }
  pre code { background-color: transparent; color: inherit; padding: 0; }
  
  /* è¡¨æ ¼ */
  table { width: 100%; border-collapse: collapse; margin: 25px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
  th { background-color: #f8fafc; color: #1e293b; padding: 15px; text-align: left; font-weight: 600; border-bottom: 2px solid #e2e8f0; }
  td { padding: 15px; border-bottom: 1px solid #e2e8f0; color: #475569; }
  tr:hover { background-color: #f1f5f9; }
  
  /* æç¤ºæ¡† */
  .note { background-color: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 20px; margin: 25px 0; display: flex; align-items: start; }
  .note-icon { font-size: 1.5rem; margin-right: 15px; }
  .note-content strong { color: #1d4ed8; display: block; margin-bottom: 5px; }
  
  /* å•†ä¸šä»·å€¼å¡ç‰‡ */
  .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0; }
  .card { background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 25px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); transition: transform 0.2s; }
  .card:hover { transform: translateY(-5px); border-color: #38bdf8; }
  .card h4 { margin-top: 0; color: #0f172a; font-size: 1.2rem; }
</style>
</head>
<body>

<div class="app-container">
  <!-- å·¦ä¾§ç›®å½• -->
  <div class="sidebar">
    <div class="sidebar-header">
      ğŸš€ ç¬¬41-42å‘¨å­¦ä¹ ç¬”è®°
    </div>
    <div class="sidebar-nav">
      <a href="#intro">1. æ ¸å¿ƒç›®æ ‡ï¼šé™æœ¬å¢æ•ˆ</a>
      <a href="#redis-concept">2. ä»€ä¹ˆæ˜¯ Redisï¼Ÿ</a>
      <a href="#workflow">3. ç¼“å­˜å·¥ä½œæµ (Mermaid)</a>
      <a href="#code-analysis">4. å®æˆ˜ä»£ç è§£æ</a>
      <a href="#business-value">5. å•†ä¸šä»·å€¼åˆ†æ</a>
      <a href="#summary">6. æ€»ç»“ä¸ä¸‹ä¸€æ­¥</a>
    </div>
  </div>

  <!-- å³ä¾§æ­£æ–‡ -->
  <div class="main-content">
    <div class="content-wrapper">
      
      <h1 id="intro">ğŸ’¡ æ€§èƒ½ä¼˜åŒ–ä¸æˆæœ¬æ§åˆ¶ï¼šRedis ç¼“å­˜å®æˆ˜</h1>
      
      <div class="note">
        <div class="note-icon">ğŸ’°</div>
        <div class="note-content">
          <strong>ä¸ºä»€ä¹ˆè¦åšè¿™ä¸€å‘¨ï¼Ÿ</strong>
          <p>åœ¨ä¼ä¸šçº§åº”ç”¨ä¸­ï¼Œå¤§æ¨¡å‹ API çš„è°ƒç”¨æ˜¯æŒ‰ Token è®¡è´¹çš„ã€‚å¦‚æœ 1000 ä¸ªäººé—®åŒä¸€ä¸ªé—®é¢˜ï¼Œæ²¡æœ‰ç¼“å­˜å°±æ„å‘³ç€è¦ä»˜ 1000 æ¬¡é’±ã€‚æœ¬å‘¨çš„ç›®æ ‡æ˜¯åˆ©ç”¨ <strong>Redis</strong> è®©è¿™ 999 æ¬¡é‡å¤è°ƒç”¨å˜æˆå…è´¹ï¼</p>
        </div>
      </div>

      <h2 id="redis-concept">ğŸ“š æ¦‚å¿µè§£æï¼šRedis</h2>
      <p><strong>Redis (Remote Dictionary Server)</strong> æ˜¯ä¸€ä¸ªå¼€æºçš„å†…å­˜æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿã€‚</p>
      <table>
        <thead>
          <tr>
            <th>ç‰¹æ€§</th>
            <th>è¯´æ˜</th>
            <th>æ¯”å–»</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>å†…å­˜å­˜å‚¨</strong></td>
            <td>æ•°æ®å­˜åœ¨å†…å­˜æ¡é‡Œï¼Œè¯»å†™é€Ÿåº¦æå¿«ï¼ˆå¾®ç§’çº§ï¼‰ã€‚</td>
            <td>åƒä½ å¤§è„‘çš„â€œçŸ­æœŸè®°å¿†â€ï¼Œååº”æå¿«ã€‚</td>
          </tr>
          <tr>
            <td><strong>Key-Value ç»“æ„</strong></td>
            <td>é€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„é”®ï¼ˆKeyï¼‰æŸ¥æ‰¾å¯¹åº”çš„å€¼ï¼ˆValueï¼‰ã€‚</td>
            <td>åƒè¶…å¸‚çš„å‚¨ç‰©æŸœï¼Œå‡­å°ç¥¨ï¼ˆKeyï¼‰å–åŒ…ï¼ˆValueï¼‰ã€‚</td>
          </tr>
          <tr>
            <td><strong>æŒä¹…åŒ–</strong></td>
            <td>å¯ä»¥å®šæœŸæŠŠæ•°æ®å­˜åˆ°ç¡¬ç›˜ï¼Œé˜²æ­¢æ–­ç”µä¸¢å¤±ã€‚</td>
            <td>æŠŠçŸ­æœŸè®°å¿†å†™è¿›æ—¥è®°æœ¬ã€‚</td>
          </tr>
        </tbody>
      </table>

      <h2 id="workflow">ğŸ”„ ç¼“å­˜å·¥ä½œæµ (Mermaid å¯è§†åŒ–)</h2>
      <p>è¿™æ˜¯æˆ‘ä»¬æœ¬å‘¨å®ç°çš„ <code>smart_query</code> å‡½æ•°çš„æ ¸å¿ƒé€»è¾‘ï¼š</p>
      
      <pre class="mermaid">
graph TD
    A[ç”¨æˆ·æé—®: "ä»€ä¹ˆæ˜¯é‡åŒ–äº¤æ˜“?"] --> B{Redis ä¸­æœ‰ç¼“å­˜å—?}
    B -- âœ… å‘½ä¸­ (Hit) --> C[ç›´æ¥è¿”å› Redis ä¸­çš„æ•°æ®]
    C --> D[ğŸ’° æˆæœ¬: $0 | â±ï¸ è€—æ—¶: 0.001s]
    B -- âŒ æœªå‘½ä¸­ (Miss) --> E[è°ƒç”¨å¤§æ¨¡å‹ API (è´¹é’±!)]
    E --> F[è·å¾— AI å›ç­”]
    F --> G[å­˜å…¥ Redis (è®¾ç½®è¿‡æœŸæ—¶é—´)]
    G --> H[è¿”å›ç»™ç”¨æˆ·]
    H --> I[ğŸ’¸ æˆæœ¬: $0.002 | â±ï¸ è€—æ—¶: 1.5s]
      </pre>

      <h2 id="code-analysis">ğŸ’» å®æˆ˜ä»£ç è§£æ</h2>
      <p>æ ¸å¿ƒä»£ç ä½äº <a href="file:///f:/Desktop/ä¸ªäººèµ„æ–™/å¤§æ¨¡å‹å­¦ä¹ é¡¹ç›®/ç¬¬41_42å‘¨/cost_optimization.py">cost_optimization.py</a>ï¼Œä»¥ä¸‹æ˜¯å…³é”®æŠ€æœ¯ç‚¹ï¼š</p>

      <h3>1. ç”Ÿæˆå”¯ä¸€çš„ Cache Key</h3>
      <p>ä¸ºäº†é˜²æ­¢é—®é¢˜å¤ªé•¿å¯¼è‡´ Key ä¸åˆæ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨ MD5 å“ˆå¸Œç®—æ³•å°†é—®é¢˜â€œæŒ‡çº¹åŒ–â€ã€‚</p>
      <pre><code class="language-python">import hashlib

# åŸå§‹é—®é¢˜
prompt = "å¦‚ä½•å­¦ä¹  Python?......(å‡è®¾è¿™é‡Œè¿˜æœ‰500å­—)"

# ç”ŸæˆæŒ‡çº¹ (å›ºå®šé•¿åº¦ 32 ä½å­—ç¬¦)
prompt_hash = hashlib.md5(prompt.encode()).hexdigest()
# ç»“æœ: e10adc3949ba59abbe56e057f20f883e

# æœ€ç»ˆ Key
cache_key = f"cache:qwen:{prompt_hash}"</code></pre>

      <h3>2. è®¾ç½®è¿‡æœŸæ—¶é—´ (TTL)</h3>
      <p>ç¼“å­˜ä¸èƒ½æ°¸ä¹…æœ‰æ•ˆï¼ˆå› ä¸ºä¸–ç•Œåœ¨å˜ï¼ŒAI æ¨¡å‹ä¹Ÿåœ¨å˜ï¼‰ï¼Œå¿…é¡»è®¾ç½® TTL (Time To Live)ã€‚</p>
      <pre><code class="language-python"># set(key, value, ex=3600)
# ex=3600 è¡¨ç¤ºè¿™æ¡æ•°æ® 1 å°æ—¶åè‡ªåŠ¨è‡ªæ¯
redis_client.set(cache_key, result, ex=3600)</code></pre>

      <h2 id="business-value">ğŸ’ å•†ä¸šä»·å€¼åˆ†æ</h2>
      <p>åœ¨â€œåˆ›ä¸šè€…æ€ç»´â€ä¸­ï¼ŒæŠ€æœ¯å¿…é¡»æœåŠ¡äºåˆ©æ¶¦ã€‚ç¼“å­˜ç³»ç»Ÿèƒ½å¸¦æ¥ä»€ä¹ˆï¼Ÿ</p>
      
      <div class="card-grid">
        <div class="card">
          <h4>ğŸ“‰ æˆæœ¬éª¤é™</h4>
          <p>å¯¹äºçƒ­é—¨äº‹ä»¶æˆ–é«˜é¢‘é—®é¢˜ï¼ˆå¦‚â€œå¦‚ä½•é‡ç½®å¯†ç â€ï¼‰ï¼Œç¼“å­˜å‘½ä¸­ç‡å¯è¾¾ 90% ä»¥ä¸Šï¼Œç›´æ¥èŠ‚çœ 90% çš„ API è´¹ç”¨ã€‚</p>
        </div>
        <div class="card">
          <h4>ğŸš€ ä½“éªŒé£å‡</h4>
          <p>API è°ƒç”¨é€šå¸¸éœ€è¦ 1-3 ç§’ï¼Œè€Œè¯»å– Redis åªéœ€è¦å‡ æ¯«ç§’ã€‚ç”¨æˆ·ä½“éªŒä»â€œè½¬åœˆåœˆâ€å˜æˆâ€œç§’å›â€ã€‚</p>
        </div>
        <div class="card">
          <h4>ğŸ›¡ï¸ ç³»ç»Ÿä¿æŠ¤</h4>
          <p>å½“æµé‡æš´å¢æ—¶ï¼Œç¼“å­˜æŒ¡åœ¨ API å‰é¢ï¼Œé˜²æ­¢å› ä¸ºè¯·æ±‚è¿‡å¤šå¯¼è‡´ API é™æµæˆ–ç³»ç»Ÿå´©æºƒã€‚</p>
        </div>
      </div>

      <h2 id="summary">ğŸ“ æ€»ç»“ä¸ä¸‹ä¸€æ­¥</h2>
      <ul>
        <li><strong>æœ¬å‘¨æˆå°±</strong>ï¼šæˆåŠŸåœ¨ WSL ç¯å¢ƒéƒ¨ç½² Redisï¼Œå¹¶ç¼–å†™ Python è„šæœ¬å®ç°äº†â€œæŸ¥è¯¢ç¼“å­˜â€æœºåˆ¶ã€‚</li>
        <li><strong>å…³é”®æ•°æ®</strong>ï¼šåœ¨æµ‹è¯•è„šæœ¬ä¸­ï¼Œé‡å¤é—®é¢˜å®ç°äº† <strong>100% æˆæœ¬èŠ‚çœ</strong>ã€‚</li>
        <li><strong>ä¸‹ä¸€æ­¥ (ç¬¬43å‘¨)</strong>ï¼šæˆ‘ä»¬å°†è¿›å…¥äº‘ç«¯å¾®è°ƒ (ModelScope Swift)ï¼Œåˆ©ç”¨å…è´¹çš„ GPU ç®—åŠ›æ¥è®­ç»ƒå±äºè‡ªå·±çš„â€œå°æ¨¡å‹â€ã€‚</li>
      </ul>

      <br><br><br>
    </div>
  </div>
</div>

</body>
</html>
