# 第41-42周实操指南：Redis 缓存与成本优化

> **核心目标**：在 Linux (WSL) 环境中部署 Redis 数据库，并使用 Python 实现“提问缓存”功能，从而降低重复的大模型 API 调用费用。

---

## ⚠️ 重要前提：请在 WSL 中操作！

Redis 是典型的 Linux 原生软件。虽然 Windows 也有版本，但在 WSL 中安装和管理是**最标准、最符合生产环境**的做法。

请确保你的 VS Code 已经连接到 **WSL: Ubuntu**。

---

## 第一步：安装 Redis (在 WSL 终端)

在 VS Code 的终端中（确保是 `bash` 或 `zsh`，显示 `user@...`），运行以下命令：

```bash
# 1. 更新软件列表
sudo apt update

# 2. 安装 Redis 服务器
sudo apt install redis-server -y

# 3. 启动 Redis 服务
sudo service redis-server start

# 4. 验证是否启动成功 (应该返回 PONG)
redis-cli ping
```
*如果返回 `PONG`，说明 Redis 已经在后台运行了！*

---

## 第二步：准备 Python 环境

```bash
# 1. 进入本周目录
cd /mnt/f/Desktop/个人资料/大模型学习项目/第41_42周

# 2. 安装依赖 (主要是 redis 的 python 库)
pip install -r requirements.txt
```

---

## 第三步：运行优化脚本

我们准备了一个模拟脚本 `cost_optimization.py`，它会模拟“调用 API 还要花钱”的场景。

```bash
# 运行脚本
python3 cost_optimization.py
```

### 观察重点：
1.  **第一次**问某个问题时：会显示 `[Cache] ❌ 未命中`，并且有延时（模拟 API 调用）。
2.  **第二次**问**同一个**问题时：会显示 `[Cache] ✅ 命中缓存`，瞬间返回，且成本为 0。
3.  最后看底部的**节省金额**统计。

---

## 第四步：进阶挑战 (可选)

如果你想把这个应用到真正的项目中（比如之前的图文问答）：

1.  修改 `cost_optimization.py`。
2.  把 `mock_expensive_api_call` 函数里的代码换成你真实的 `dashscope.Generation.call(...)`。
3.  这样，你真实的 API 账单就能实实在在地省钱了！
