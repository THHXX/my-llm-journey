# 第二周：调用 Qwen API 学习笔记

## 目标
- 成功调用阿里云百炼的 Qwen 模型，拿到回复。
- 记录环境准备、关键代码、运行与提交步骤。

## 准备工作
- 注册/登录阿里云百炼：https://bailian.console.aliyun.com/
- 完成实名认证（如提示），创建应用并生成 API Key。
- 将密钥保存到环境变量 `DASHSCOPE_API_KEY`，避免写入代码。

## 环境与依赖
PowerShell 命令均含注释：
```pwsh
python -m venv .venv  # 创建虚拟环境
.\.venv\Scripts\Activate.ps1  # 激活虚拟环境
python -m pip install --upgrade pip  # 升级 pip
python -m pip install -r requirements.txt  # 安装 dashscope 等依赖
```

### 设置 API Key
- 临时（当前会话有效）：
```pwsh
$env:DASHSCOPE_API_KEY="sk-xxx"  # 替换为你的百炼密钥
```
- 永久（写入用户环境变量，重开终端生效）：
```pwsh
setx DASHSCOPE_API_KEY "sk-xxx"  # 替换为你的百炼密钥
```

## 关键代码（`第二周/qwen_call.py`）
核心调用：
```python
from dashscope import Generation

response = Generation.call(
    model="qwen-max",
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    prompt=prompt,
)
```
完整脚本做了三件事：
1. 读取环境变量 `DASHSCOPE_API_KEY`，缺失则报错退出。
2. 接收命令行参数作为提示词（默认“你好，请介绍一下你自己”）。
3. 调用 `Generation.call`，若状态码 OK 则打印 `response.output.text`，否则输出错误信息到 stderr。

## 运行示例
```pwsh
python qwen_call.py  # 使用默认提示词调用模型
python qwen_call.py 请用50字介绍一下量子计算  # 传入自定义提示
```
成功时会打印：
- “模型回复：” + 模型生成的文本。
失败时常见原因：
- 环境变量未设置；配额不足；网络/权限问题。

## Git 提交流程
```pwsh
git status  # 查看当前变更
git add 第二周  # 暂存第二周相关文件
git commit -m "Add Qwen API call example and notes"  # 提交
git push  # 推送到远端
```

## 小结
- 使用官方 SDK `dashscope` 可免去手写 HTTP 请求。
- API Key 始终放环境变量，不写入仓库。
- PowerShell 下命令加注释便于回顾与分享。***

## 强制将本地所有代码提交
```pwsh
git rebase --abort  # 若仍在 rebase 状态，先退出；若无则忽略提示
git add .  # 暂存所有本地文件
git commit -m "Force replace remote with local"  # 提交当前快照；若提示无改动可忽略
git push -f origin main  # 强制推送，本地内容覆盖远端
```

## 小总结（适合现在怎么记）
- sys.argv：原始参数列表，简单粗暴，适合“只要一句 prompt”这种。
  - sys.argv[1:]：脚本名后面所有内容。
  - " ".join(sys.argv[1:])：把这些内容拼成一句话，当成 prompt。
- argparse：专业参数解析器，适合有很多选项（--input、--output、--top 等）的脚本，帮你：
  - 自动解析命名参数
  - 自动处理类型、默认值、--help